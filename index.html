<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAN Keypad Control</title>
    <style>
        body { background: #0b0b0b; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
        .btn-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 400px; margin: 20px auto; }
        .key { background: #1c1c1c; border: 2px solid #333; color: #fff; padding: 25px 0; border-radius: 12px; font-weight: bold; cursor: pointer; }
        .key:active { background: #0066ff; transform: scale(0.95); }
        #connectBtn { background: #0066ff; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 18px; cursor: pointer; }
        .status { margin: 15px; color: #888; }
    </style>
</head>
<body>
    <h1>CAN Dashboard</h1>
    <button id="connectBtn">CONNECT TO KEYPAD</button>
    <div id="status" class="status">Status: Disconnected</div>
    
    <div class="btn-grid" id="grid" style="display:none;">
        </div>

    <script>
        const SERVICE_UUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
        const RX_UUID = "6e400002-b5a3-f393-e0a9-e50e24dcca9e";
        let rxChar;

        document.getElementById('connectBtn').addEventListener('click', async () => {
            try {
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: [SERVICE_UUID]
                });

                const server = await device.gatt.connect();
                const service = await server.getPrimaryService(SERVICE_UUID);
                rxChar = await service.getCharacteristic(RX_UUID);

                document.getElementById('status').innerText = "Status: Connected to " + device.name;
                document.getElementById('connectBtn').style.display = 'none';
                document.getElementById('grid').style.display = 'grid';
                setupGrid();
            } catch (err) {
                alert("Error: " + err.message);
            }
        });

        function setupGrid() {
            const grid = document.getElementById('grid');
            for (let i = 0; i < 15; i++) {
                const b = document.createElement('div');
                b.className = 'key';
                b.innerText = "BTN " + (i + 1);
                b.onclick = () => sendPress(i);
                grid.appendChild(b);
            }
        }

        function sendPress(id) {
            if (rxChar) {
                const data = new TextEncoder().encode("P" + id);
                rxChar.writeValue(data);
            }
        }
    </script>
</body>
</html>